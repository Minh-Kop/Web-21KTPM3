<div class="container mb-3 p-0">
    <div class='text-start px-4 row' style='background-color: #eae7dc'>
        <p class='fs-2 fw-bold mb-0' style='color: #e85a4f'>Danh sách tài khoản</p>
        <div class="col-3 mt-3 h-100 sticky-top" style="top: 5%">
            <div class="text-center" style="height: 210px; background-color: #d8c3a5">
                <img class="img-fluid mx-auto d-block p-2" src="{{avatarPath}}" alt="" style="
                                    height: 170px;
                                    border-radius: 50%;
                                    aspect-ratio: 1/1;
                                " />
                <span class="fs-4" style="color: #c05b5b">{{username}}</span>
            </div>
            <div class="d-flex align-items-center justify-content-center text-center mt-3"
                style="height: 50px; background-color: #ffffff">
                <a href="/admin/book" class="fs-5" style="text-decoration: none; color: black">Sản phẩm</a>
            </div>
            <div class="d-flex align-items-center justify-content-center text-center mt-3"
                style="height: 50px; background-color: #ffffff">
                <a href="/order" class="fs-5" style="text-decoration: none; color: black">Đơn hàng</a>
            </div>
            <div class="d-flex align-items-center justify-content-center text-center mt-3"
                style="height: 50px; background-color: #ffffff">
                <a href="/statistic" class="fs-5" style="text-decoration: none; color: black">Thống kê</a>
            </div>
            <div class="d-flex align-items-center justify-content-center text-center mt-3"
                style="height: 50px; background-color: #e98074">
                <a href="/user" class="fs-5" style="text-decoration: none; color: #ffffff">Tài khoản</a>
            </div>
            <div class="d-flex align-items-center justify-content-center text-center mt-3"
                style="height: 50px; background-color: #ffffff">
                <a href="/admin/category" class="fs-5" style="text-decoration: none; color: black">Danh mục</a>
            </div>
        </div>
        <div class='container col-9'>
            <div class='container mt-3 border border-success rounded text-start' style='background-color: FFFFFF'>
                <div class="container row position-relative">
                    <h4 class="mt-2 mb-3 col-4">Danh sách người dùng</h4>
                    <button type="button" class="add-addr-btn btn btn-danger w-auto fw-bold mt-2 mb-3 position-absolute top-0 end-0 ">
                        <a href="/user/createUser" style="color: white">Thêm người dùng mới</a>
                    </button>
                </div>
                <table class='table table-striped table-hover text-center'>
                    <thead>
                        <tr>
                            <th scope='col'>Avatar</th>
                            <th scope='col'>Username</th>
                            <th scope='col'>Email</th>
                            <th scope='col'>Họ và tên</th>
                            <th scope='col'>SDT</th>
                            <th scope='col'>Giới tính</th>
                            <th scope='col'>Ngày sinh</th>
                            <th scope='col'>Vai trò</th>
                            <th scope='col'></th>
                            <th scope='col'></th>
                        </tr>
                    </thead>
                    <tbody>
                        {{#each users}}
                        <tr>
                            <td>
                                <img src='{{avatarPath}}' alt='' class='img-thumbnail'
                                    style='width: 100px; height: 100px; object-fit: contain' />
                            </td>
                            <td>{{username}}</td>
                            <td>{{email}}</td>
                            <td>{{fullName}}</td>
                            <td>{{phoneNumber}}</td>
                            <td>{{#if gender}} Nữ {{else}} Nam {{/if}}</td>
                            <td>{{birthday}}</td>
                            <td>{{getRole role}}</td>
                            <td>
                                {{#eq userId ../userId}} 
                                {{else}}
                                    <i class='fa-solid fa-trash delete' style='cursor: pointer' data-id='{{userId}}'
                                        ></i>
                                {{/eq}}
                            </td>
                            <td>
                                <a href='/user/{{userId}}' style='color: black'>
                                    <i class='fa-solid fa-circle-info' style='cursor: pointer'></i>
                                </a>
                            </td>
                        </tr>
                        {{/each}}
                    </tbody>
                </table>
            </div>
        </div>

    </div>
</div>
<script>
    $(".delete").click(function () {
        const swalWithBootstrapButtons =
            Swal.mixin({
                customClass: {
                    confirmButton: "btn btn-success ms-3",
                    cancelButton: "btn btn-danger",
                }, buttonsStyling: false,
            });
        swalWithBootstrapButtons.fire({
            title: "Bạn có chắc là muốn xóa người dùng này?",
            text: "Bạn sẽ không thể hoàn tác!", icon: "warning",
            showCancelButton: true, confirmButtonText: "Xóa!",
            cancelButtonText: "Hủy.",
            reverseButtons: true,
        }).then((result) => {
            if (result.isConfirmed) {
                const userId = $(this).data("id");
                    $.ajax({
                        type: "DELETE", 
                        url: `/user/${userId}`,
                        success: function (response) {
                            swalWithBootstrapButtons.fire({
                                title: "Đã xóa!",
                                text: "Người dùng đã xóa thành công",
                                icon: "success",
                            }).then(() => {
                                location.reload();
                            });
                        }, error: function (error) {
                            swalWithBootstrapButtons.fire({
                                title: "Xóa thất bại",
                            });
                        },
                    });
            } else if (
                result.dismiss === Swal.DismissReason.cancel) {
                swalWithBootstrapButtons.fire({ title: "Đã hủy", icon: "error", });
            }
        });
    });
</script>